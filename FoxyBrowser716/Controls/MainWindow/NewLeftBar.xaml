<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="FoxyBrowser716.Controls.MainWindow.NewLeftBar"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:mainWindow="using:FoxyBrowser716.Controls.MainWindow"
    xmlns:helpers="using:FoxyBrowser716.Controls.Helpers"
    xmlns:complex="using:FoxyBrowser716.DataObjects.Complex"
    xmlns:staticData="using:FoxyBrowser716.StaticData"
    xmlns:basic="using:FoxyBrowser716.DataObjects.Basic"
    mc:Ignorable="d">
    <UserControl.Resources>
        <helpers:ColorToBrushConverter x:Key="ColorToBrushConverter"/>
        <helpers:UrlToImageControlConverter x:Key="UrlToImageControlConverter"/>
    </UserControl.Resources>
    
    <Grid x:Name="Root" CornerRadius="0,8,8,8" BorderThickness="2" Width="30" HorizontalAlignment="Left"
          PointerEntered="Root_OnPointerEntered" PointerExited="Root_OnPointerExited" DragEnter="Root_OnDragEnter" DragLeave="Root_OnDragLeave" AllowDrop="True"
          Background="{x:Bind CurrentTheme.PrimaryBackgroundColorVeryTransparent, Converter={StaticResource ColorToBrushConverter}, Mode=OneWay}"
          BorderBrush="{x:Bind CurrentTheme.SecondaryBackgroundColor, Converter={StaticResource ColorToBrushConverter}, Mode=OneWay}">
        
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto" x:Name="PinsRow"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <mainWindow:TabCard Grid.Row="0" x:Name="HomeCard" ShowClose="False" ShowDuplicate="False" Id="-1" CurrentTheme="{x:Bind CurrentTheme, Mode=OneWay}" OnClick="HomeCard_OnOnClick"/>
        <ScrollViewer Grid.Row="1" Visibility="{x:Bind TabsVisible}"
              VerticalScrollBarVisibility="Hidden"
              HorizontalScrollBarVisibility="Disabled"
              HorizontalAlignment="Stretch"
              ZoomMode="Disabled">
            <StackPanel x:Name="Tabs" HorizontalAlignment="Stretch">
                <ListView ItemsSource="{x:Bind TabManager.Tabs, Mode=OneWay}" MinHeight="10"
                          SelectionMode="None"
                          IsItemClickEnabled="True"
                          CanReorderItems="True"
                          CanDragItems="True"
                          AllowDrop="True"
                          DragItemsStarting="TabsList_DragItemsStarting"
                          DragItemsCompleted="TabsList_DragItemsCompleted"
                          DragOver="TabsList_DragOver"
                          Drop="TabsList_Drop"
                          DragEnter="TabsList_DragEnter"
                          HorizontalAlignment="Stretch"
                          ItemClick="ListViewBase_OnItemClick">
                    
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="complex:WebviewTab">
                            <mainWindow:NewTabCard Title="{x:Bind Info.Title, Mode=OneWay}"
                                                   ForceHighlight="{x:Bind IsActive, Mode=OneWay}"
                                                   Icon="{x:Bind Info.FavIconUrl, Converter={StaticResource UrlToImageControlConverter}, Mode=OneWay}"
                                                   CurrentTheme="{x:Bind TabManager.Instance.CurrentTheme, Mode=OneWay}"
                                                   Tag="{x:Bind}"
                                                   OnClick="TabCard_OnClick"
                                                   CloseRequested="TabCard_OnCloseRequested"
                                                   DuplicateRequested="TabCard_OnDuplicateRequested"
                                                   MenuItemFactory="{x:Bind GetMenuItems, Mode=OneWay}"
                            />
                        </DataTemplate>
                    </ListView.ItemTemplate>
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="MinHeight" Value="0"/>
                            <Setter Property="MinWidth" Value="0"/>
                            <Setter Property="Height" Value="26"/>
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>

                <ListView ItemsSource="{x:Bind TabManager.Groups, Mode=OneWay}"
                          SelectionMode="None"
                          IsItemClickEnabled="False"
                          CanReorderItems="True"
                          CanDragItems="True"
                          AllowDrop="True"
                          DragOver="GroupsList_DragOver"
                          Drop="GroupsList_Drop"
                          DragEnter="GroupsList_DragEnter"
                          DragItemsStarting="GroupsList_DragItemsStarting">
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="basic:TabGroup">
                            <mainWindow:NewTabGroupCard CurrentTheme="{x:Bind TabManager.Instance.CurrentTheme, Mode=OneWay}"
                                                        Tag="{x:Bind}" 
                                                        TabGroup="{x:Bind}"
                            />
                        </DataTemplate>
                    </ListView.ItemTemplate>
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            <Setter Property="Padding" Value="0"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="MinHeight" Value="0"/>
                            <Setter Property="MinWidth" Value="0"/>
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>
                
                <Border x:Name="DropArea" DragOver="UIElement_OnDragOver" DragEnter="UIElement_OnDragEnter" Drop="UIElement_OnDrop" CornerRadius="8" Height="42" Background="{x:Bind CurrentTheme.PrimaryBackgroundColorSlightTransparent, Converter={StaticResource ColorToBrushConverter}, Mode=OneWay}" Visibility="{x:Bind MoveTipsVisible, Mode=OneWay}">
                    <TextBlock x:Name="DropAreaText" Text="+ New Tab Group" Foreground="{x:Bind CurrentTheme.PrimaryForegroundColorSlightTransparent, Converter={StaticResource ColorToBrushConverter}, Mode=OneWay}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>
            </StackPanel>
        </ScrollViewer>
        
        
        <ScrollViewer Grid.Row="1" Visibility="{x:Bind WidgetsVisible, Mode=OneWay}"
                      VerticalScrollBarVisibility="Hidden"
                      HorizontalScrollBarVisibility="Disabled"
                      HorizontalAlignment="Stretch"
                      ZoomMode="Disabled">
            <StackPanel x:Name="Widgets" HorizontalAlignment="Stretch"/>
        </ScrollViewer>
        
        <Border Grid.Row="2" CornerRadius="5" Margin="5" Padding="15" Visibility="Collapsed"
                Background="{x:Bind CurrentTheme.SecondaryAccentColorVeryTransparent, Converter={StaticResource ColorToBrushConverter}, Mode=OneWay}">
            <TextBlock  Text="Create New Tab Group" TextAlignment="Center"
                       Foreground="{x:Bind CurrentTheme.PrimaryForegroundColorSlightTransparent, Converter={StaticResource ColorToBrushConverter}, Mode=OneWay}"/>
        </Border>
        
        
        <Border Grid.Row="3" x:Name="Div" Height="2" Margin="2,4" CornerRadius="1" HorizontalAlignment="Stretch" 
                Background="{x:Bind CurrentTheme.SecondaryAccentColorSlightTransparent, Converter={StaticResource ColorToBrushConverter}, Mode=OneWay}"/>
        
        <ScrollViewer Grid.Row="4" Visibility="{x:Bind TabsVisible, Mode=OneWay}"
                      VerticalScrollBarVisibility="Hidden" 
                      HorizontalScrollBarVisibility="Disabled"
                      HorizontalAlignment="Stretch"
                      ZoomMode="Disabled">
            <StackPanel x:Name="Pins" HorizontalAlignment="Stretch" Tag="{x:Bind CurrentTheme, Mode=OneWay}">
                <ItemsRepeater ItemsSource="{x:Bind TabManager.Instance.Pins, Mode=OneWay}">
                    <ItemsRepeater.ItemTemplate>
                        <DataTemplate x:DataType="basic:WebsiteInfo">
                            <mainWindow:NewTabCard Title="{x:Bind Title}"
                                                   Icon="{x:Bind FavIconUrl, Converter={StaticResource UrlToImageControlConverter}, Mode=OneWay}"
                                                   CurrentTheme="{Binding ElementName=Pins, Path=Tag, Mode=OneWay}" Tag="{x:Bind}"   
                                                   DuplicateVisible="Collapsed" OnClick="PinCard_OnClick" CloseRequested="PinCard_OnCloseRequested" 
                                                   OnDragStarted="NewTabCard_OnOnDragStarted"
                                                   OnDragMoved="NewTabCard_OnOnDragMoved"
                                                   OnDragCompleted="NewTabCard_OnOnDragCompleted"
                                                   />
                        </DataTemplate>
                    </ItemsRepeater.ItemTemplate>
                </ItemsRepeater>
            </StackPanel>
        </ScrollViewer>
        
        <ScrollViewer Grid.Row="4" Visibility="{x:Bind WidgetsVisible, Mode=OneWay}"
                      VerticalScrollBarVisibility="Hidden"
                      HorizontalScrollBarVisibility="Disabled"
                      HorizontalAlignment="Stretch"
                      ZoomMode="Disabled">
            <StackPanel x:Name="EditOptions" HorizontalAlignment="Stretch"/>
        </ScrollViewer>

        <mainWindow:TabCard Grid.Row="6" x:Name="PinCard" ShowClose="False" ShowDuplicate="False" Visibility="Collapsed" CurrentTheme="{x:Bind CurrentTheme, Mode=OneWay}" OnClick="PinCard_OnOnClick"/>
        <mainWindow:TabCard Grid.Row="7" x:Name="BookmarkCard" ShowClose="False" ShowDuplicate="False" Visibility="Collapsed" CurrentTheme="{x:Bind CurrentTheme, Mode=OneWay}" OnClick="BookmarkCard_OnOnClick"/>
    </Grid>
</UserControl>